import{_ as ee,d as z,b as f,p as le,c as ae,a as l,w as a,r as n,V as te,E as p,s as se,o as E,k as _,x as oe,j as i,i as F,t as re,I as ne,W as j,z as de,X as ue,Y as ie,Z as me}from"./index-BAzr2iUZ.js";const pe={class:"user-manage"},ce={class:"card-header"},fe={class:"search-bar"},ge={class:"pagination"},ve={class:"dialog-footer"},we={class:"dialog-footer"},be={__name:"index",setup(_e){const m=z({username:"",role:"",status:""}),S=f([]),k=f(!1),C=f(1),U=f(10),q=f(0),g=f(!1),x=f(""),V=f(!1),o=z({id:null,username:"",email:"",password:"",role:"user",status:"active"}),d=z({id:null,password:"",confirmPassword:""}),N={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},R={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(s,e,r)=>{e!==d.password?r(new Error("两次输入密码不一致")):r()},trigger:"blur"}]},v=async()=>{k.value=!0;try{const s=await te({page:C.value,size:U.value,...m});S.value=s.users,q.value=s.total}catch{p.error("获取用户列表失败")}finally{k.value=!1}},$=()=>{C.value=1,v()},I=()=>{Object.keys(m).forEach(s=>{m[s]=""}),$()},L=()=>{x.value="添加用户",Object.keys(o).forEach(s=>{o[s]=s==="role"?"user":s==="status"?"active":""}),g.value=!0},M=s=>{x.value="编辑用户",Object.keys(o).forEach(e=>{o[e]=s[e]}),g.value=!0},O=s=>{de.confirm("确定要删除该用户吗?","提示",{type:"warning"}).then(async()=>{try{await ue(s.id),p.success("删除成功"),v()}catch{p.error("删除失败")}})},T=async()=>{try{o.id?(await j(o.id,o),p.success("更新成功")):(await ie(o),p.success("创建成功")),g.value=!1,v()}catch{p.error(o.id?"更新失败":"创建失败")}},A=s=>{d.id=s.id,d.password="",d.confirmPassword="",V.value=!0},W=async()=>{try{await me(d.id,d.password),p.success("重置密码成功"),V.value=!1}catch{p.error("重置密码失败")}},X=async s=>{try{await j(s.id,{status:s.status}),p.success("状态更新成功")}catch{p.error("状态更新失败"),s.status=s.status==="active"?"inactive":"active"}},Y=s=>{U.value=s,v()},Z=s=>{C.value=s,v()};return le(()=>{v()}),(s,e)=>{const r=n("el-button"),w=n("el-input"),u=n("el-form-item"),b=n("el-option"),h=n("el-select"),P=n("el-form"),c=n("el-table-column"),G=n("el-tag"),B=n("el-switch"),H=n("el-table"),J=n("el-pagination"),D=n("el-dialog"),K=n("el-card"),Q=se("loading");return E(),ae("div",pe,[l(K,{class:"box-card"},{header:a(()=>[_("div",ce,[e[15]||(e[15]=_("span",null,"用户管理",-1)),l(r,{type:"primary",onClick:L},{default:a(()=>e[14]||(e[14]=[i("添加用户")])),_:1})])]),default:a(()=>[_("div",fe,[l(P,{inline:!0,model:m,class:"demo-form-inline"},{default:a(()=>[l(u,{label:"用户名"},{default:a(()=>[l(w,{modelValue:m.username,"onUpdate:modelValue":e[0]||(e[0]=t=>m.username=t),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"角色"},{default:a(()=>[l(h,{modelValue:m.role,"onUpdate:modelValue":e[1]||(e[1]=t=>m.role=t),placeholder:"请选择角色",clearable:""},{default:a(()=>[l(b,{label:"管理员",value:"admin"}),l(b,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"状态"},{default:a(()=>[l(h,{modelValue:m.status,"onUpdate:modelValue":e[2]||(e[2]=t=>m.status=t),placeholder:"请选择状态",clearable:""},{default:a(()=>[l(b,{label:"启用",value:"active"}),l(b,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(r,{type:"primary",onClick:$},{default:a(()=>e[16]||(e[16]=[i("搜索")])),_:1}),l(r,{onClick:I},{default:a(()=>e[17]||(e[17]=[i("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),oe((E(),F(H,{data:S.value,style:{width:"100%"}},{default:a(()=>[l(c,{prop:"id",label:"ID",width:"80"}),l(c,{prop:"username",label:"用户名",width:"120"}),l(c,{prop:"email",label:"邮箱",width:"180"}),l(c,{prop:"role",label:"角色",width:"100"},{default:a(t=>[l(G,{type:t.row.role==="admin"?"danger":"info"},{default:a(()=>[i(re(t.row.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"status",label:"状态",width:"100"},{default:a(t=>[l(B,{modelValue:t.row.status,"onUpdate:modelValue":y=>t.row.status=y,"active-value":"active","inactive-value":"inactive",onChange:y=>X(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(c,{prop:"last_login",label:"最后登录",width:"180"}),l(c,{prop:"created_at",label:"创建时间",width:"180"}),l(c,{label:"操作",width:"200"},{default:a(t=>[l(r,{type:"primary",link:"",onClick:y=>M(t.row)},{default:a(()=>e[18]||(e[18]=[i("编辑")])),_:2},1032,["onClick"]),l(r,{type:"primary",link:"",onClick:y=>A(t.row)},{default:a(()=>e[19]||(e[19]=[i("重置密码")])),_:2},1032,["onClick"]),l(r,{type:"danger",link:"",onClick:y=>O(t.row)},{default:a(()=>e[20]||(e[20]=[i("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,k.value]]),_("div",ge,[l(J,{"current-page":C.value,"page-size":U.value,total:q.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:Y,onCurrentChange:Z},null,8,["current-page","page-size","total"])]),l(D,{title:x.value,modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=t=>g.value=t),width:"500px","close-on-click-modal":!1},{footer:a(()=>[_("span",ve,[l(r,{onClick:e[8]||(e[8]=t=>g.value=!1)},{default:a(()=>e[21]||(e[21]=[i("取消")])),_:1}),l(r,{type:"primary",onClick:T},{default:a(()=>e[22]||(e[22]=[i("确定")])),_:1})])]),default:a(()=>[l(P,{ref:"userForm",model:o,rules:N,"label-width":"100px"},{default:a(()=>[l(u,{label:"用户名",prop:"username"},{default:a(()=>[l(w,{modelValue:o.username,"onUpdate:modelValue":e[3]||(e[3]=t=>o.username=t),disabled:!!o.id},null,8,["modelValue","disabled"])]),_:1}),l(u,{label:"邮箱",prop:"email"},{default:a(()=>[l(w,{modelValue:o.email,"onUpdate:modelValue":e[4]||(e[4]=t=>o.email=t)},null,8,["modelValue"])]),_:1}),o.id?ne("",!0):(E(),F(u,{key:0,label:"密码",prop:"password"},{default:a(()=>[l(w,{modelValue:o.password,"onUpdate:modelValue":e[5]||(e[5]=t=>o.password=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1})),l(u,{label:"角色",prop:"role"},{default:a(()=>[l(h,{modelValue:o.role,"onUpdate:modelValue":e[6]||(e[6]=t=>o.role=t),placeholder:"请选择角色"},{default:a(()=>[l(b,{label:"管理员",value:"admin"}),l(b,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"状态",prop:"status"},{default:a(()=>[l(B,{modelValue:o.status,"onUpdate:modelValue":e[7]||(e[7]=t=>o.status=t),"active-value":"active","inactive-value":"inactive"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(D,{title:"重置密码",modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=t=>V.value=t),width:"400px","close-on-click-modal":!1},{footer:a(()=>[_("span",we,[l(r,{onClick:e[12]||(e[12]=t=>V.value=!1)},{default:a(()=>e[23]||(e[23]=[i("取消")])),_:1}),l(r,{type:"primary",onClick:W},{default:a(()=>e[24]||(e[24]=[i("确定")])),_:1})])]),default:a(()=>[l(P,{ref:"resetPasswordForm",model:d,rules:R,"label-width":"100px"},{default:a(()=>[l(u,{label:"新密码",prop:"password"},{default:a(()=>[l(w,{modelValue:d.password,"onUpdate:modelValue":e[10]||(e[10]=t=>d.password=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(u,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[l(w,{modelValue:d.confirmPassword,"onUpdate:modelValue":e[11]||(e[11]=t=>d.confirmPassword=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})])}}},ye=ee(be,[["__scopeId","data-v-82fe2cdf"]]);export{ye as default};
