import{U as X,_ as Z,C as $,c as x,k as l,a,x as ee,w as s,r as d,s as te,i as E,b as u,G as le,p as ae,E as F,e as se,o as b,j as i,t as r,I as V}from"./index-BAzr2iUZ.js";import{getAlerts as oe,getAlertStats as ne,updateAlertStatus as re,getAlertDetail as ie}from"./alert-7o6wXh13.js";function de(y,e="HH:mm:ss"){return y?X(y).format(e):"-"}const ue={name:"AlertManagement",components:{Search:$},setup(){const y=se(),e=u(!1),D=u(!1),t=u([]),M=u({}),A=u(""),v=u(""),c=u(""),g=u([]),p=u(1),S=u(20),z=u(0),L=u(!1),w=u(!1),m=u(null),C=u(null),T=u({resolution:""}),f={resolution:[{required:!0,message:"请输入处理说明",trigger:"blur"}]},U=le(()=>t.value.filter(n=>{var j;const _=!A.value||n.message.toLowerCase().includes(A.value.toLowerCase())||n.target.toLowerCase().includes(A.value.toLowerCase()),R=!v.value||n.level===v.value,O=!c.value||n.status===c.value,W=!((j=g.value)!=null&&j.length)||new Date(n.created_at)>=new Date(g.value[0])&&new Date(n.created_at)<=new Date(g.value[1]);return _&&R&&O&&W})),h=async()=>{try{e.value=!0;const[n,_]=await Promise.all([oe({page:p.value,per_page:S.value}),ne()]);n.code===200&&(t.value=n.data.items,z.value=n.data.total),_.code===200&&(M.value=_.data)}catch{F.error("获取数据失败")}finally{e.value=!1}},B=()=>{h()},G=async n=>{try{const _=await ie(n.id);_.code===200&&(m.value=_.data,L.value=!0)}catch{F.error("获取告警详情失败")}},P=n=>{m.value=n,T.value={resolution:""},w.value=!0},N=async()=>{if(C.value)try{await C.value.validate(),D.value=!0,(await re(m.value.id,{status:"resolved",resolution:T.value.resolution})).code===200&&(F.success("处理成功"),w.value=!1,L.value=!1,h())}catch{F.error("处理失败")}finally{D.value=!1}},Q=n=>{const _=n.type.split("_")[0],R=n.target_id;switch(_){case"server":y.push(`/servers/${R}`);break;case"gpu":y.push(`/gpus/${R}`);break;case"business":y.push(`/business/${R}`);break}},Y=n=>{S.value=n,h()},o=n=>{p.value=n,h()},k=n=>n==="critical"?"严重":"警告",H=n=>n==="critical"?"danger":"warning",I=n=>({server_offline:"服务器离线",server_high_cpu:"服务器CPU使用率过高",server_high_memory:"服务器内存使用率过高",gpu_usage:"GPU使用率过高",gpu_temperature:"GPU温度过高",gpu_memory:"GPU显存使用率过高",business_error:"业务运行错误",business_offline:"业务离线"})[n]||n,q=n=>({server_offline:"danger",server_high_cpu:"warning",server_high_memory:"warning",gpu_usage:"warning",gpu_temperature:"danger",gpu_memory:"warning",business_error:"danger",business_offline:"warning"})[n]||"info",J=n=>n==="unresolved"?"未处理":"已处理",K=n=>n==="unresolved"?"warning":"success";return ae(()=>{h()}),{loading:e,submitting:D,alerts:t,stats:M,searchQuery:A,filterLevel:v,filterStatus:c,dateRange:g,currentPage:p,pageSize:S,total:z,detailVisible:L,resolveVisible:w,currentAlert:m,resolveFormRef:C,resolveForm:T,resolveRules:f,filteredAlerts:U,handleRefresh:B,handleDetail:G,handleResolve:P,handleResolveSubmit:N,handleTargetClick:Q,handleSizeChange:Y,handleCurrentChange:o,getLevelLabel:k,getLevelTag:H,getTypeLabel:I,getTypeTag:q,getStatusLabel:J,getStatusTag:K,formatTime:de}}},ce={class:"alert-management"},_e={class:"title-container"},ve={class:"card-header"},ge={class:"stats-content"},me={class:"stats-item"},fe={class:"value warning"},pe={class:"stats-item"},be={class:"value success"},ye={class:"card-header"},he={class:"stats-content"},we={class:"stats-item"},Ce={class:"value danger"},ke={class:"stats-item"},Ve={class:"value success"},Ae={class:"card-header"},Se={class:"stats-content"},Le={class:"stats-item"},Te={class:"value warning"},Re={class:"stats-item"},xe={class:"value success"},De={class:"card-header"},ze={class:"stats-content"},Ue={class:"stats-item"},Pe={class:"value warning"},Fe={class:"stats-item"},Me={class:"value success"},Be={class:"search-container"},Ge={class:"pagination-container"},Ne={key:0,class:"alert-detail"},Qe={class:"detail-item"},Ye={class:"detail-item"},Ee={class:"detail-item"},je={class:"detail-item"},He={class:"value"},Ie={class:"detail-item"},qe={class:"value"},Je={class:"detail-item"},Ke={key:0,class:"detail-item"},Oe={class:"value"},We={key:1,class:"detail-item"},Xe={class:"value"},Ze={key:2,class:"detail-item"},$e={class:"value"},et={class:"dialog-footer"},tt={class:"dialog-footer"};function lt(y,e,D,t,M,A){const v=d("el-button"),c=d("el-tag"),g=d("el-card"),p=d("el-col"),S=d("el-row"),z=d("Search"),L=d("el-icon"),w=d("el-input"),m=d("el-option"),C=d("el-select"),T=d("el-date-picker"),f=d("el-table-column"),U=d("el-link"),h=d("el-button-group"),B=d("el-table"),G=d("el-pagination"),P=d("el-dialog"),N=d("el-form-item"),Q=d("el-form"),Y=te("loading");return b(),x("div",ce,[l("div",_e,[e[12]||(e[12]=l("h2",null,"告警列表",-1)),a(v,{type:"primary",onClick:t.handleRefresh,loading:t.loading},{default:s(()=>e[11]||(e[11]=[i(" 刷新 ")])),_:1},8,["onClick","loading"])]),a(S,{gutter:20,class:"stats-container"},{default:s(()=>[a(p,{span:6},{default:s(()=>[a(g,{shadow:"hover",class:"stats-card"},{header:s(()=>[l("div",ve,[e[13]||(e[13]=l("span",null,"总告警数",-1)),a(c,{type:"info"},{default:s(()=>[i(r(t.stats.total||0),1)]),_:1})])]),default:s(()=>[l("div",ge,[l("div",me,[e[14]||(e[14]=l("span",{class:"label"},"未处理",-1)),l("span",fe,r(t.stats.unresolved||0),1)]),l("div",pe,[e[15]||(e[15]=l("span",{class:"label"},"已处理",-1)),l("span",be,r(t.stats.resolved||0),1)])])]),_:1})]),_:1}),a(p,{span:6},{default:s(()=>[a(g,{shadow:"hover",class:"stats-card"},{header:s(()=>[l("div",ye,[e[16]||(e[16]=l("span",null,"严重告警",-1)),a(c,{type:"danger"},{default:s(()=>[i(r(t.stats.critical||0),1)]),_:1})])]),default:s(()=>[l("div",he,[l("div",we,[e[17]||(e[17]=l("span",{class:"label"},"未处理",-1)),l("span",Ce,r(t.stats.critical_unresolved||0),1)]),l("div",ke,[e[18]||(e[18]=l("span",{class:"label"},"已处理",-1)),l("span",Ve,r(t.stats.critical_resolved||0),1)])])]),_:1})]),_:1}),a(p,{span:6},{default:s(()=>[a(g,{shadow:"hover",class:"stats-card"},{header:s(()=>[l("div",Ae,[e[19]||(e[19]=l("span",null,"警告",-1)),a(c,{type:"warning"},{default:s(()=>[i(r(t.stats.warning||0),1)]),_:1})])]),default:s(()=>[l("div",Se,[l("div",Le,[e[20]||(e[20]=l("span",{class:"label"},"未处理",-1)),l("span",Te,r(t.stats.warning_unresolved||0),1)]),l("div",Re,[e[21]||(e[21]=l("span",{class:"label"},"已处理",-1)),l("span",xe,r(t.stats.warning_resolved||0),1)])])]),_:1})]),_:1}),a(p,{span:6},{default:s(()=>[a(g,{shadow:"hover",class:"stats-card"},{header:s(()=>[l("div",De,[e[22]||(e[22]=l("span",null,"今日告警",-1)),a(c,{type:"info"},{default:s(()=>[i(r(t.stats.today||0),1)]),_:1})])]),default:s(()=>[l("div",ze,[l("div",Ue,[e[23]||(e[23]=l("span",{class:"label"},"未处理",-1)),l("span",Pe,r(t.stats.today_unresolved||0),1)]),l("div",Fe,[e[24]||(e[24]=l("span",{class:"label"},"已处理",-1)),l("span",Me,r(t.stats.today_resolved||0),1)])])]),_:1})]),_:1})]),_:1}),l("div",Be,[a(w,{modelValue:t.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=o=>t.searchQuery=o),placeholder:"搜索告警...",class:"search-input",clearable:""},{prefix:s(()=>[a(L,null,{default:s(()=>[a(z)]),_:1})]),_:1},8,["modelValue"]),a(C,{modelValue:t.filterLevel,"onUpdate:modelValue":e[1]||(e[1]=o=>t.filterLevel=o),placeholder:"告警级别",clearable:""},{default:s(()=>[a(m,{label:"严重",value:"critical"}),a(m,{label:"警告",value:"warning"})]),_:1},8,["modelValue"]),a(C,{modelValue:t.filterStatus,"onUpdate:modelValue":e[2]||(e[2]=o=>t.filterStatus=o),placeholder:"处理状态",clearable:""},{default:s(()=>[a(m,{label:"未处理",value:"unresolved"}),a(m,{label:"已处理",value:"resolved"})]),_:1},8,["modelValue"]),a(T,{modelValue:t.dateRange,"onUpdate:modelValue":e[3]||(e[3]=o=>t.dateRange=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),ee((b(),E(B,{data:t.filteredAlerts,style:{width:"100%"},border:""},{default:s(()=>[a(f,{prop:"level",label:"级别",width:"100"},{default:s(({row:o})=>[a(c,{type:t.getLevelTag(o.level)},{default:s(()=>[i(r(t.getLevelLabel(o.level)),1)]),_:2},1032,["type"])]),_:1}),a(f,{prop:"type",label:"类型",width:"120"},{default:s(({row:o})=>[a(c,{type:t.getTypeTag(o.type)},{default:s(()=>[i(r(t.getTypeLabel(o.type)),1)]),_:2},1032,["type"])]),_:1}),a(f,{prop:"target",label:"告警对象",width:"200"},{default:s(({row:o})=>[a(U,{type:"primary",onClick:k=>t.handleTargetClick(o)},{default:s(()=>[i(r(o.target),1)]),_:2},1032,["onClick"])]),_:1}),a(f,{prop:"message",label:"告警信息"}),a(f,{prop:"status",label:"状态",width:"100"},{default:s(({row:o})=>[a(c,{type:t.getStatusTag(o.status)},{default:s(()=>[i(r(t.getStatusLabel(o.status)),1)]),_:2},1032,["type"])]),_:1}),a(f,{prop:"created_at",label:"时间",width:"180"},{default:s(({row:o})=>[i(r(t.formatTime(o.created_at)),1)]),_:1}),a(f,{label:"操作",width:"150",fixed:"right"},{default:s(({row:o})=>[a(h,null,{default:s(()=>[a(v,{type:"primary",size:"small",onClick:k=>t.handleDetail(o)},{default:s(()=>e[25]||(e[25]=[i(" 详情 ")])),_:2},1032,["onClick"]),o.status==="unresolved"?(b(),E(v,{key:0,type:"success",size:"small",onClick:k=>t.handleResolve(o)},{default:s(()=>e[26]||(e[26]=[i(" 处理 ")])),_:2},1032,["onClick"])):V("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Y,t.loading]]),l("div",Ge,[a(G,{"current-page":t.currentPage,"page-size":t.pageSize,total:t.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),a(P,{modelValue:t.detailVisible,"onUpdate:modelValue":e[7]||(e[7]=o=>t.detailVisible=o),title:"告警详情",width:"600px"},{footer:s(()=>{var o;return[l("span",et,[a(v,{onClick:e[5]||(e[5]=k=>t.detailVisible=!1)},{default:s(()=>e[36]||(e[36]=[i("关闭")])),_:1}),((o=t.currentAlert)==null?void 0:o.status)==="unresolved"?(b(),E(v,{key:0,type:"primary",onClick:e[6]||(e[6]=k=>t.handleResolve(t.currentAlert))},{default:s(()=>e[37]||(e[37]=[i(" 处理 ")])),_:1})):V("",!0)])]}),default:s(()=>[t.currentAlert?(b(),x("div",Ne,[l("div",Qe,[e[27]||(e[27]=l("span",{class:"label"},"告警级别:",-1)),a(c,{type:t.getLevelTag(t.currentAlert.level)},{default:s(()=>[i(r(t.getLevelLabel(t.currentAlert.level)),1)]),_:1},8,["type"])]),l("div",Ye,[e[28]||(e[28]=l("span",{class:"label"},"告警类型:",-1)),a(c,{type:t.getTypeTag(t.currentAlert.type)},{default:s(()=>[i(r(t.getTypeLabel(t.currentAlert.type)),1)]),_:1},8,["type"])]),l("div",Ee,[e[29]||(e[29]=l("span",{class:"label"},"告警对象:",-1)),a(U,{type:"primary",onClick:e[4]||(e[4]=o=>t.handleTargetClick(t.currentAlert))},{default:s(()=>[i(r(t.currentAlert.target),1)]),_:1})]),l("div",je,[e[30]||(e[30]=l("span",{class:"label"},"告警信息:",-1)),l("span",He,r(t.currentAlert.message),1)]),l("div",Ie,[e[31]||(e[31]=l("span",{class:"label"},"告警时间:",-1)),l("span",qe,r(t.formatTime(t.currentAlert.created_at)),1)]),l("div",Je,[e[32]||(e[32]=l("span",{class:"label"},"处理状态:",-1)),a(c,{type:t.getStatusTag(t.currentAlert.status)},{default:s(()=>[i(r(t.getStatusLabel(t.currentAlert.status)),1)]),_:1},8,["type"])]),t.currentAlert.resolved_at?(b(),x("div",Ke,[e[33]||(e[33]=l("span",{class:"label"},"处理时间:",-1)),l("span",Oe,r(t.formatTime(t.currentAlert.resolved_at)),1)])):V("",!0),t.currentAlert.resolved_by?(b(),x("div",We,[e[34]||(e[34]=l("span",{class:"label"},"处理人:",-1)),l("span",Xe,r(t.currentAlert.resolved_by),1)])):V("",!0),t.currentAlert.resolution?(b(),x("div",Ze,[e[35]||(e[35]=l("span",{class:"label"},"处理说明:",-1)),l("span",$e,r(t.currentAlert.resolution),1)])):V("",!0)])):V("",!0)]),_:1},8,["modelValue"]),a(P,{modelValue:t.resolveVisible,"onUpdate:modelValue":e[10]||(e[10]=o=>t.resolveVisible=o),title:"处理告警",width:"500px"},{footer:s(()=>[l("span",tt,[a(v,{onClick:e[9]||(e[9]=o=>t.resolveVisible=!1)},{default:s(()=>e[38]||(e[38]=[i("取消")])),_:1}),a(v,{type:"primary",onClick:t.handleResolveSubmit,loading:t.submitting},{default:s(()=>e[39]||(e[39]=[i(" 确定 ")])),_:1},8,["onClick","loading"])])]),default:s(()=>[a(Q,{ref:"resolveFormRef",model:t.resolveForm,rules:t.resolveRules,"label-width":"100px"},{default:s(()=>[a(N,{label:"处理说明",prop:"resolution"},{default:s(()=>[a(w,{modelValue:t.resolveForm.resolution,"onUpdate:modelValue":e[8]||(e[8]=o=>t.resolveForm.resolution=o),type:"textarea",rows:3,placeholder:"请输入处理说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const ot=Z(ue,[["render",lt],["__scopeId","data-v-5178446b"]]);export{ot as default};
