import{S as C,_ as I,C as M,c as N,k as V,x as R,a as e,w as n,r as d,s as j,i as F,b as u,G as H,p as J,E as m,z as K,o as D,j as p,t as E}from"./index-BAzr2iUZ.js";function O(i){return C({url:"/api/alert-configs",method:"get",params:i})}function W(i){return C({url:"/api/alert-configs",method:"post",data:i})}function Q(i){return C({url:`/api/alert-configs/${i.id}`,method:"put",data:i})}function X(i){return C({url:`/api/alert-configs/${i}`,method:"delete"})}function Y(){return C({url:"/api/alert-configs/init",method:"post"})}const Z={name:"AlertConfigs",components:{Search:M},setup(){const i=u(!1),l=u(!1),w=u(!1),t=u([]),U=u(""),T=u(""),c=u(""),v=u(!1),f=u("add"),b=u(null),r=u({type:"",level:"",threshold:0,description:"",enabled:!0}),y={type:[{required:!0,message:"请选择告警类型",trigger:"change"}],level:[{required:!0,message:"请选择告警级别",trigger:"change"}],threshold:[{required:!0,message:"请输入阈值",trigger:"blur"}]},x=H(()=>t.value.filter(o=>{const g=!U.value||o.description.toLowerCase().includes(U.value.toLowerCase()),q=!T.value||o.type===T.value,z=!c.value||o.level===c.value;return g&&q&&z})),s=async()=>{try{i.value=!0;const o=await O();o.code===200&&(t.value=o.data)}catch{m.error("获取告警配置失败")}finally{i.value=!1}},L=async()=>{try{l.value=!0,(await Y()).code===200&&(m.success("初始化成功"),s())}catch{m.error("初始化失败")}finally{l.value=!1}},k=()=>{f.value="add",r.value={type:"",level:"",threshold:0,description:"",enabled:!0},v.value=!0},G=o=>{f.value="edit",r.value={...o},v.value=!0},_=o=>{K.confirm("确定要删除该告警配置吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{(await X(o.id)).code===200&&(m.success("删除成功"),s())}catch{m.error("删除失败")}})},P=async()=>{if(b.value)try{await b.value.validate(),w.value=!0,(await(f.value==="add"?W:Q)(r.value)).code===200&&(m.success(f.value==="add"?"添加成功":"更新成功"),v.value=!1,s())}catch{m.error(f.value==="add"?"添加失败":"更新失败")}finally{w.value=!1}},S=async o=>{try{(await Q({id:o.id,enabled:o.enabled})).code===200&&m.success("状态更新成功")}catch{m.error("状态更新失败"),o.enabled=!o.enabled}},A=o=>({gpu_usage:"GPU使用率",gpu_temperature:"GPU温度",gpu_memory:"GPU显存"})[o]||o,B=o=>({gpu_usage:"primary",gpu_temperature:"warning",gpu_memory:"success"})[o]||"info",a=o=>o==="warning"?"警告":"严重",h=o=>o==="warning"?"warning":"danger";return J(()=>{s()}),{loading:i,initLoading:l,submitting:w,configs:t,searchQuery:U,filterType:T,filterLevel:c,dialogVisible:v,dialogType:f,formRef:b,form:r,rules:y,filteredConfigs:x,handleInit:L,handleAdd:k,handleEdit:G,handleDelete:_,handleSubmit:P,handleStatusChange:S,getTypeLabel:A,getTypeTag:B,getLevelLabel:a,getLevelTag:h}}},$={class:"alert-configs"},ee={class:"title-container"},le={class:"actions"},te={class:"search-container"},ae={class:"dialog-footer"};function oe(i,l,w,t,U,T){const c=d("el-button"),v=d("Search"),f=d("el-icon"),b=d("el-input"),r=d("el-option"),y=d("el-select"),x=d("el-tag"),s=d("el-table-column"),L=d("el-switch"),k=d("el-button-group"),G=d("el-table"),_=d("el-form-item"),P=d("el-input-number"),S=d("el-form"),A=d("el-dialog"),B=j("loading");return D(),N("div",$,[V("div",ee,[l[12]||(l[12]=V("h2",null,"告警配置",-1)),V("div",le,[e(c,{type:"primary",onClick:t.handleInit,loading:t.initLoading},{default:n(()=>l[10]||(l[10]=[p(" 初始化默认配置 ")])),_:1},8,["onClick","loading"]),e(c,{type:"success",onClick:t.handleAdd},{default:n(()=>l[11]||(l[11]=[p(" 添加配置 ")])),_:1},8,["onClick"])])]),V("div",te,[e(b,{modelValue:t.searchQuery,"onUpdate:modelValue":l[0]||(l[0]=a=>t.searchQuery=a),placeholder:"搜索配置...",class:"search-input",clearable:""},{prefix:n(()=>[e(f,null,{default:n(()=>[e(v)]),_:1})]),_:1},8,["modelValue"]),e(y,{modelValue:t.filterType,"onUpdate:modelValue":l[1]||(l[1]=a=>t.filterType=a),placeholder:"告警类型",clearable:""},{default:n(()=>[e(r,{label:"GPU使用率",value:"gpu_usage"}),e(r,{label:"GPU温度",value:"gpu_temperature"}),e(r,{label:"GPU显存",value:"gpu_memory"})]),_:1},8,["modelValue"]),e(y,{modelValue:t.filterLevel,"onUpdate:modelValue":l[2]||(l[2]=a=>t.filterLevel=a),placeholder:"告警级别",clearable:""},{default:n(()=>[e(r,{label:"警告",value:"warning"}),e(r,{label:"严重",value:"critical"})]),_:1},8,["modelValue"])]),R((D(),F(G,{data:t.filteredConfigs,style:{width:"100%"},border:""},{default:n(()=>[e(s,{prop:"type",label:"告警类型",width:"120"},{default:n(({row:a})=>[e(x,{type:t.getTypeTag(a.type)},{default:n(()=>[p(E(t.getTypeLabel(a.type)),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"level",label:"告警级别",width:"100"},{default:n(({row:a})=>[e(x,{type:t.getLevelTag(a.level)},{default:n(()=>[p(E(t.getLevelLabel(a.level)),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"threshold",label:"阈值",width:"120"},{default:n(({row:a})=>[p(E(a.threshold)+"% ",1)]),_:1}),e(s,{prop:"description",label:"说明"}),e(s,{prop:"enabled",label:"状态",width:"100"},{default:n(({row:a})=>[e(L,{modelValue:a.enabled,"onUpdate:modelValue":h=>a.enabled=h,onChange:h=>t.handleStatusChange(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(s,{label:"操作",width:"150",fixed:"right"},{default:n(({row:a})=>[e(k,null,{default:n(()=>[e(c,{type:"primary",size:"small",onClick:h=>t.handleEdit(a)},{default:n(()=>l[13]||(l[13]=[p(" 编辑 ")])),_:2},1032,["onClick"]),e(c,{type:"danger",size:"small",onClick:h=>t.handleDelete(a)},{default:n(()=>l[14]||(l[14]=[p(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[B,t.loading]]),e(A,{modelValue:t.dialogVisible,"onUpdate:modelValue":l[9]||(l[9]=a=>t.dialogVisible=a),title:t.dialogType==="add"?"添加告警配置":"编辑告警配置",width:"500px"},{footer:n(()=>[V("span",ae,[e(c,{onClick:l[8]||(l[8]=a=>t.dialogVisible=!1)},{default:n(()=>l[16]||(l[16]=[p("取消")])),_:1}),e(c,{type:"primary",onClick:t.handleSubmit,loading:t.submitting},{default:n(()=>l[17]||(l[17]=[p(" 确定 ")])),_:1},8,["onClick","loading"])])]),default:n(()=>[e(S,{ref:"formRef",model:t.form,rules:t.rules,"label-width":"100px"},{default:n(()=>[e(_,{label:"告警类型",prop:"type"},{default:n(()=>[e(y,{modelValue:t.form.type,"onUpdate:modelValue":l[3]||(l[3]=a=>t.form.type=a),placeholder:"请选择告警类型"},{default:n(()=>[e(r,{label:"GPU使用率",value:"gpu_usage"}),e(r,{label:"GPU温度",value:"gpu_temperature"}),e(r,{label:"GPU显存",value:"gpu_memory"})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"告警级别",prop:"level"},{default:n(()=>[e(y,{modelValue:t.form.level,"onUpdate:modelValue":l[4]||(l[4]=a=>t.form.level=a),placeholder:"请选择告警级别"},{default:n(()=>[e(r,{label:"警告",value:"warning"}),e(r,{label:"严重",value:"critical"})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"阈值",prop:"threshold"},{default:n(()=>[e(P,{modelValue:t.form.threshold,"onUpdate:modelValue":l[5]||(l[5]=a=>t.form.threshold=a),min:0,max:100,step:1},null,8,["modelValue"]),l[15]||(l[15]=V("span",{class:"unit"},"%",-1))]),_:1}),e(_,{label:"说明",prop:"description"},{default:n(()=>[e(b,{modelValue:t.form.description,"onUpdate:modelValue":l[6]||(l[6]=a=>t.form.description=a),type:"textarea",rows:3,placeholder:"请输入配置说明"},null,8,["modelValue"])]),_:1}),e(_,{label:"状态"},{default:n(()=>[e(L,{modelValue:t.form.enabled,"onUpdate:modelValue":l[7]||(l[7]=a=>t.form.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const re=I(Z,[["render",oe],["__scopeId","data-v-224e85e9"]]);export{re as default};
