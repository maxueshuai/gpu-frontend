import{_ as P,b as V,G as w,g as q,d as N,p as $,c as L,a,w as s,r as t,E as p,e as M,o as T,j as i,t as b,B as y,k}from"./index-BAzr2iUZ.js";import{c as j,u as z,e as A}from"./server-DI7Mx269.js";const F={class:"server-config-container"},H={class:"card-header"},J={__name:"config",setup(K){const _=M(),U=q(),g=V(null),d=V(!1),m=w(()=>U.params.id),f=w(()=>!!m.value),e=N({name:"",ip_address:"",port:"22",username:"",password:"",grafana_url:"",grafana_port:"",grafana_username:"",grafana_password:"",status:"online"}),G={name:[{required:!0,message:"请输入服务器名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],ip_address:[{required:!0,message:"请输入IP地址",trigger:"blur"},{pattern:/^(\d{1,3}\.){3}\d{1,3}$/,message:"请输入正确的IP地址",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},x=async()=>{if(m.value){d.value=!0;try{const{data:r}=await j(m.value);r&&(e.name=r.name||"",e.ip_address=r.ip||"",e.port=r.port||"22",e.username=r.username||"",e.password=r.password||"",e.status=r.status||"online",e.grafana_url=r.grafana_url||"",e.grafana_port=r.grafana_port||"",e.grafana_username=r.grafana_username||"",e.grafana_password=r.grafana_password||"")}catch(r){console.error("获取服务器详情失败:",r),p.error("获取服务器详情失败："+(r.message||"未知错误"))}finally{d.value=!1}}},I=async()=>{if(g.value)try{await g.value.validate(),d.value=!0;const r={name:e.name,ip_address:e.ip_address,port:parseInt(e.port)||22,username:e.username||null,password:e.password||null,status:e.status,grafana_url:e.grafana_url||null,grafana_port:e.grafana_port||"3000",grafana_username:e.grafana_username||null,grafana_password:e.grafana_password||null};console.log("提交数据:",r),f.value?(await z(m.value,r),p.success("更新服务器成功")):(await A(r),p.success("添加服务器成功")),setTimeout(()=>{_.push("/servers")},500)}catch(r){console.error("保存服务器失败:",r),r.response&&r.response.data&&r.response.data.detail?p.error("保存服务器失败："+r.response.data.detail):p.error("保存服务器失败："+(r.message||"未知错误"))}finally{d.value=!1}};return $(()=>{f.value&&x()}),(r,l)=>{const B=t("Back"),R=t("el-icon"),c=t("el-button"),u=t("el-input"),n=t("el-form-item"),v=t("el-option"),S=t("el-select"),C=t("el-divider"),D=t("el-form"),E=t("el-card");return T(),L("div",F,[a(E,null,{header:s(()=>[k("div",H,[a(c,{link:"",onClick:l[0]||(l[0]=o=>y(_).back())},{default:s(()=>[a(R,null,{default:s(()=>[a(B)]),_:1}),l[12]||(l[12]=i("返回 "))]),_:1}),k("h3",null,b(f.value?"编辑服务器":"添加服务器"),1)])]),default:s(()=>[a(D,{ref_key:"formRef",ref:g,model:e,rules:G,"label-width":"120px",class:"server-form"},{default:s(()=>[a(n,{label:"服务器名称",prop:"name"},{default:s(()=>[a(u,{modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=o=>e.name=o),placeholder:"请输入服务器名称"},null,8,["modelValue"])]),_:1}),a(n,{label:"IP地址",prop:"ip_address"},{default:s(()=>[a(u,{modelValue:e.ip_address,"onUpdate:modelValue":l[2]||(l[2]=o=>e.ip_address=o),placeholder:"请输入IP地址"},null,8,["modelValue"])]),_:1}),a(n,{label:"端口"},{default:s(()=>[a(u,{modelValue:e.port,"onUpdate:modelValue":l[3]||(l[3]=o=>e.port=o),placeholder:"请输入服务器端口"},null,8,["modelValue"])]),_:1}),a(n,{label:"用户名"},{default:s(()=>[a(u,{modelValue:e.username,"onUpdate:modelValue":l[4]||(l[4]=o=>e.username=o),placeholder:"请输入服务器用户名"},null,8,["modelValue"])]),_:1}),a(n,{label:"密码"},{default:s(()=>[a(u,{modelValue:e.password,"onUpdate:modelValue":l[5]||(l[5]=o=>e.password=o),placeholder:"请输入服务器密码",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(n,{label:"状态"},{default:s(()=>[a(S,{modelValue:e.status,"onUpdate:modelValue":l[6]||(l[6]=o=>e.status=o),placeholder:"请选择服务器状态",style:{width:"100%"}},{default:s(()=>[a(v,{label:"在线",value:"online"}),a(v,{label:"离线",value:"offline"}),a(v,{label:"维护中",value:"maintenance"})]),_:1},8,["modelValue"])]),_:1}),a(C,{"content-position":"left"},{default:s(()=>l[13]||(l[13]=[i("Grafana监控配置（可选）")])),_:1}),a(n,{label:"Grafana URL"},{default:s(()=>[a(u,{modelValue:e.grafana_url,"onUpdate:modelValue":l[7]||(l[7]=o=>e.grafana_url=o),placeholder:"请输入Grafana URL"},null,8,["modelValue"])]),_:1}),a(n,{label:"Grafana 端口"},{default:s(()=>[a(u,{modelValue:e.grafana_port,"onUpdate:modelValue":l[8]||(l[8]=o=>e.grafana_port=o),placeholder:"请输入Grafana端口"},null,8,["modelValue"])]),_:1}),a(n,{label:"Grafana 用户名"},{default:s(()=>[a(u,{modelValue:e.grafana_username,"onUpdate:modelValue":l[9]||(l[9]=o=>e.grafana_username=o),placeholder:"请输入Grafana用户名"},null,8,["modelValue"])]),_:1}),a(n,{label:"Grafana 密码"},{default:s(()=>[a(u,{modelValue:e.grafana_password,"onUpdate:modelValue":l[10]||(l[10]=o=>e.grafana_password=o),placeholder:"请输入Grafana密码",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(n,null,{default:s(()=>[a(c,{type:"primary",onClick:I,loading:d.value},{default:s(()=>[i(b(f.value?"保存修改":"添加服务器"),1)]),_:1},8,["loading"]),a(c,{onClick:l[11]||(l[11]=o=>y(_).back())},{default:s(()=>l[14]||(l[14]=[i("取消")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},W=P(J,[["__scopeId","data-v-93d4d31a"]]);export{W as default};
