import{_ as I,b as r,p as K,c as L,a as t,w as n,r as l,E as h,e as j,s as q,o as x,x as Q,k as g,i as R,j as i,t as F,A as G,B as w,C as H,D as J,z as O}from"./index-BAzr2iUZ.js";import{g as W,d as X}from"./servers-D_Ew1Wx1.js";const Y={class:"server-list-container"},Z={class:"card-header"},ee={class:"left"},te={class:"right"},ae={class:"pagination-container"},ne={__name:"list",setup(se){const p=j(),v=r(!1),m=r(""),c=r(1),_=r(10),y=r(0),C=r([]),u=async()=>{v.value=!0;try{const a=await W({page:c.value,page_size:_.value,search:m.value});C.value=a.items.map(e=>({id:e.id,name:e.name,ip:e.ip_address,port:e.port,username:e.username,status:e.status})),y.value=a.total}catch(a){console.error("获取服务器列表失败:",a),h.error("获取服务器列表失败")}finally{v.value=!1}},k=()=>{c.value=1,u()},z=()=>{p.push("/servers/config")},S=a=>{p.push(`/servers/${a.id}`)},B=a=>{p.push({path:"/tasks",query:{server_ip:a.ip}})},$=a=>{p.push(`/servers/${a.id}/config`)},D=a=>{O.confirm(`确定要删除服务器 ${a.name} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await X(a.id),h.success("删除成功"),u()}catch(e){console.error("删除服务器失败:",e),h.error("删除服务器失败")}}).catch(()=>{})},V=a=>{_.value=a,u()},E=a=>{c.value=a,u()};return K(()=>{u()}),(a,e)=>{const b=l("el-icon"),T=l("el-input"),d=l("el-button"),o=l("el-table-column"),M=l("el-tag"),N=l("el-table"),P=l("el-pagination"),U=l("el-card"),A=q("loading");return x(),L("div",Y,[t(U,null,{header:n(()=>[g("div",Z,[g("div",ee,[t(T,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),placeholder:"搜索服务器",style:{width:"200px"},clearable:"",onClear:k,onKeyup:G(k,["enter"])},{prefix:n(()=>[t(b,null,{default:n(()=>[t(w(H))]),_:1})]),_:1},8,["modelValue"])]),g("div",te,[t(d,{type:"success",onClick:z},{default:n(()=>[t(b,null,{default:n(()=>[t(w(J))]),_:1}),e[3]||(e[3]=i("添加服务器 "))]),_:1})])])]),default:n(()=>[Q((x(),R(N,{data:C.value,border:"",style:{width:"100%"}},{default:n(()=>[t(o,{prop:"name",label:"服务器名称","min-width":"120"}),t(o,{prop:"ip",label:"IP地址","min-width":"120"}),t(o,{prop:"port",label:"端口",width:"80",align:"center"}),t(o,{prop:"username",label:"用户名","min-width":"100"}),t(o,{prop:"status",label:"状态",width:"100",align:"center"},{default:n(({row:s})=>[t(M,{type:s.status==="online"?"success":"danger"},{default:n(()=>[i(F(s.status==="online"?"在线":"离线"),1)]),_:2},1032,["type"])]),_:1}),t(o,{label:"操作",width:"250",fixed:"right"},{default:n(({row:s})=>[t(d,{type:"primary",link:"",onClick:f=>S(s)},{default:n(()=>e[4]||(e[4]=[i("详情")])),_:2},1032,["onClick"]),t(d,{type:"success",link:"",onClick:f=>B(s)},{default:n(()=>e[5]||(e[5]=[i("任务")])),_:2},1032,["onClick"]),t(d,{type:"warning",link:"",onClick:f=>$(s)},{default:n(()=>e[6]||(e[6]=[i("配置")])),_:2},1032,["onClick"]),t(d,{type:"danger",link:"",onClick:f=>D(s)},{default:n(()=>e[7]||(e[7]=[i("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[A,v.value]]),g("div",ae,[t(P,{"current-page":c.value,"onUpdate:currentPage":e[1]||(e[1]=s=>c.value=s),"page-size":_.value,"onUpdate:pageSize":e[2]||(e[2]=s=>_.value=s),"page-sizes":[10,20,50,100],total:y.value,layout:"total, sizes, prev, pager, next",onSizeChange:V,onCurrentChange:E},null,8,["current-page","page-size","total"])])]),_:1})])}}},re=I(ne,[["__scopeId","data-v-ab47499e"]]);export{re as default};
