import{g as F,t as te,u as ae,c as ne,a as se}from"./mongo-Cu9TCix5.js";import{b as re,d as ue}from"./system-CVVitCFZ.js";import{_ as ie,b as p,d as de,p as ce,c as y,a as o,w as l,r as s,E as c,s as me,o as f,x as P,I as B,i as T,j as u,t as m,F as E,k as S,z as pe}from"./index-BAzr2iUZ.js";const fe={class:"mongo-container"},_e={class:"card-header"},ge={key:0,class:"database-info"},ve={key:1,class:"collections-section"},be={__name:"mongo",setup(Ve){const b=p(null),x=p(!1),M=p(!1),h=p(!1),d=p(!1),C=p(!1),t=de({connectionType:"config",uri:"",host:"localhost",port:27017,database:"gpu_monitor",authentication:!1,username:"",password:"",authSource:"admin",connectTimeoutMS:3e4,maxPoolSize:10,replicaSet:""}),_=p({version:"",database:"",collections:0,documents:0,storageSize:0,indexSize:0}),U=p([]),I={uri:[{required:!0,message:"请输入连接字符串",trigger:"blur"}],host:[{required:!0,message:"请输入主机地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口号",trigger:"blur"}],database:[{required:!0,message:"请输入数据库名",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},D=async()=>{x.value=!0;try{const a=await F();a.data&&a.data.length>0&&Object.assign(t,a.data[0]),k()}catch(a){console.error("获取MongoDB配置失败:",a),c.error("获取MongoDB配置失败")}finally{x.value=!1}},k=async()=>{try{const a=await F();if(a.data&&a.data.length>0){const e=a.data[0].id,r=await te(e);d.value=r.success===!0,d.value&&r.status&&(_.value={version:r.status.version||"",database:r.status.database||"",collections:r.status.collections||0,documents:r.status.documents||0,storageSize:r.status.storageSize||0,indexSize:r.status.indexSize||0},$())}else d.value=!1}catch(a){console.error("获取MongoDB状态失败:",a),d.value=!1}},$=async()=>{if(d.value){C.value=!0;try{const a=await re();U.value=a.data||[]}catch(a){console.error("获取集合列表失败:",a),c.error("获取集合列表失败")}finally{C.value=!1}}},j=async()=>{b.value&&await b.value.validate(async a=>{if(a){M.value=!0;try{t.id?await ae(t.id,t):await ne(t),c.success("配置保存成功"),k()}catch(e){console.error("保存配置失败:",e),c.error("保存配置失败")}finally{M.value=!1}}})},A=async()=>{h.value=!0;try{const a=await se(t);a.success?(c.success("连接成功"),d.value=!0,k()):(c.error(`连接失败: ${a.message}`),d.value=!1)}catch(a){console.error("测试连接失败:",a),c.error("测试连接失败"),d.value=!1}finally{h.value=!1}},R=a=>{c.info(`查看集合 ${a.name} 的详细信息`)},G=a=>{pe.confirm(`确认删除集合 ${a.name}？此操作不可恢复！`,"警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ue(a.name),c.success("集合删除成功"),$()}catch(e){console.error("删除集合失败:",e),c.error("删除集合失败")}}).catch(()=>{})},K=()=>{b.value&&b.value.resetFields(),D()},w=a=>{if(a===0||a===void 0)return"0 B";const e=["B","KB","MB","GB","TB"],r=Math.floor(Math.log(a)/Math.log(1024));return`${(a/Math.pow(1024,r)).toFixed(2)} ${e[r]}`};return ce(()=>{D()}),(a,e)=>{const r=s("el-button"),O=s("el-tag"),i=s("el-form-item"),q=s("el-radio"),H=s("el-radio-group"),g=s("el-input"),z=s("el-input-number"),J=s("el-switch"),L=s("el-collapse-item"),Q=s("el-collapse"),W=s("el-divider"),X=s("el-form"),v=s("el-descriptions-item"),Y=s("el-descriptions"),V=s("el-table-column"),Z=s("el-button-group"),ee=s("el-table"),oe=s("el-card"),N=me("loading");return f(),y("div",fe,[o(oe,{shadow:"hover"},{header:l(()=>[S("div",_e,[e[13]||(e[13]=S("span",null,"数据库配置",-1)),o(r,{type:"primary",onClick:A,loading:h.value},{default:l(()=>e[12]||(e[12]=[u("测试连接")])),_:1},8,["loading"])])]),default:l(()=>[P((f(),T(X,{model:t,"label-width":"120px",ref_key:"formRef",ref:b,rules:I},{default:l(()=>[o(i,{label:"连接状态"},{default:l(()=>[o(O,{type:d.value?"success":"danger"},{default:l(()=>[u(m(d.value?"已连接":"未连接"),1)]),_:1},8,["type"])]),_:1}),o(i,{label:"连接方式"},{default:l(()=>[o(H,{modelValue:t.connectionType,"onUpdate:modelValue":e[0]||(e[0]=n=>t.connectionType=n)},{default:l(()=>[o(q,{label:"uri"},{default:l(()=>e[14]||(e[14]=[u("连接字符串")])),_:1}),o(q,{label:"config"},{default:l(()=>e[15]||(e[15]=[u("连接配置")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t.connectionType==="uri"?(f(),T(i,{key:0,label:"连接字符串",prop:"uri"},{default:l(()=>[o(g,{modelValue:t.uri,"onUpdate:modelValue":e[1]||(e[1]=n=>t.uri=n),placeholder:"mongodb://username:password@host:port/database"},null,8,["modelValue"])]),_:1})):(f(),y(E,{key:1},[o(i,{label:"主机",prop:"host"},{default:l(()=>[o(g,{modelValue:t.host,"onUpdate:modelValue":e[2]||(e[2]=n=>t.host=n),placeholder:"localhost"},null,8,["modelValue"])]),_:1}),o(i,{label:"端口",prop:"port"},{default:l(()=>[o(z,{modelValue:t.port,"onUpdate:modelValue":e[3]||(e[3]=n=>t.port=n),min:1,max:65535,placeholder:"27017"},null,8,["modelValue"])]),_:1}),o(i,{label:"数据库名",prop:"database"},{default:l(()=>[o(g,{modelValue:t.database,"onUpdate:modelValue":e[4]||(e[4]=n=>t.database=n),placeholder:"gpu_monitor"},null,8,["modelValue"])]),_:1}),o(i,{label:"认证"},{default:l(()=>[o(J,{modelValue:t.authentication,"onUpdate:modelValue":e[5]||(e[5]=n=>t.authentication=n)},null,8,["modelValue"])]),_:1}),t.authentication?(f(),y(E,{key:0},[o(i,{label:"用户名",prop:"username"},{default:l(()=>[o(g,{modelValue:t.username,"onUpdate:modelValue":e[6]||(e[6]=n=>t.username=n),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),o(i,{label:"密码",prop:"password"},{default:l(()=>[o(g,{modelValue:t.password,"onUpdate:modelValue":e[7]||(e[7]=n=>t.password=n),type:"password",placeholder:"密码","show-password":""},null,8,["modelValue"])]),_:1}),o(i,{label:"认证数据库",prop:"authSource"},{default:l(()=>[o(g,{modelValue:t.authSource,"onUpdate:modelValue":e[8]||(e[8]=n=>t.authSource=n),placeholder:"admin"},null,8,["modelValue"])]),_:1})],64)):B("",!0)],64)),o(i,{label:"高级选项"},{default:l(()=>[o(Q,null,{default:l(()=>[o(L,{title:"连接选项",name:"options"},{default:l(()=>[o(i,{label:"连接超时(ms)",prop:"connectTimeoutMS"},{default:l(()=>[o(z,{modelValue:t.connectTimeoutMS,"onUpdate:modelValue":e[9]||(e[9]=n=>t.connectTimeoutMS=n),min:1e3,step:1e3},null,8,["modelValue"])]),_:1}),o(i,{label:"最大连接数",prop:"maxPoolSize"},{default:l(()=>[o(z,{modelValue:t.maxPoolSize,"onUpdate:modelValue":e[10]||(e[10]=n=>t.maxPoolSize=n),min:1,max:100},null,8,["modelValue"])]),_:1}),o(i,{label:"副本集",prop:"replicaSet"},{default:l(()=>[o(g,{modelValue:t.replicaSet,"onUpdate:modelValue":e[11]||(e[11]=n=>t.replicaSet=n),placeholder:"副本集名称（可选）"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(W),o(i,null,{default:l(()=>[o(r,{type:"primary",onClick:j,loading:M.value},{default:l(()=>e[16]||(e[16]=[u("保存配置")])),_:1},8,["loading"]),o(r,{onClick:K},{default:l(()=>e[17]||(e[17]=[u("重置")])),_:1})]),_:1})]),_:1},8,["model"])),[[N,x.value]]),d.value?(f(),y("div",ge,[e[18]||(e[18]=S("h3",null,"数据库信息",-1)),o(Y,{column:2,border:""},{default:l(()=>[o(v,{label:"服务器版本"},{default:l(()=>[u(m(_.value.version||"N/A"),1)]),_:1}),o(v,{label:"数据库"},{default:l(()=>[u(m(_.value.database||"N/A"),1)]),_:1}),o(v,{label:"集合数量"},{default:l(()=>[u(m(_.value.collections||0),1)]),_:1}),o(v,{label:"文档总数"},{default:l(()=>[u(m(_.value.documents||0),1)]),_:1}),o(v,{label:"存储大小"},{default:l(()=>[u(m(w(_.value.storageSize)),1)]),_:1}),o(v,{label:"索引大小"},{default:l(()=>[u(m(w(_.value.indexSize)),1)]),_:1})]),_:1})])):B("",!0),d.value?(f(),y("div",ve,[e[21]||(e[21]=S("h3",null,"集合列表",-1)),P((f(),T(ee,{data:U.value,style:{width:"100%"},border:"",stripe:""},{default:l(()=>[o(V,{prop:"name",label:"集合名称","min-width":"150"}),o(V,{prop:"count",label:"文档数量",width:"120"}),o(V,{prop:"size",label:"存储大小",width:"120"},{default:l(({row:n})=>[u(m(w(n.size)),1)]),_:1}),o(V,{prop:"indexSize",label:"索引大小",width:"120"},{default:l(({row:n})=>[u(m(w(n.indexSize)),1)]),_:1}),o(V,{label:"操作",width:"200",fixed:"right"},{default:l(({row:n})=>[o(Z,null,{default:l(()=>[o(r,{type:"primary",link:"",onClick:le=>R(n)},{default:l(()=>e[19]||(e[19]=[u("查看")])),_:2},1032,["onClick"]),o(r,{type:"danger",link:"",onClick:le=>G(n)},{default:l(()=>e[20]||(e[20]=[u("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[N,C.value]])])):B("",!0)]),_:1})])}}},xe=ie(be,[["__scopeId","data-v-c0289928"]]);export{xe as default};
